__author__ = 'varadmeru'

# We'll need the os module for file path manipulation
import os

# And numpy for some mathematical operations
import numpy as np
import librosa

# matplotlib for displaying the output
import matplotlib.pyplot as plt

##############################################################################################################################
##############################################################################################################################
##############################################################################################################################

audiofile = "GetLucky.mp3"
print "AUDIO FILE - ", audiofile
y, sr = librosa.load(audiofile)
print "AUDIO FILE (y) - ", y
print "AUDIO FILE (sr) - ", sr

# Let's make and display a mel-scaled power (energy-squared) spectrogram
# We use a small hop length of 64 here so that the frames line up with the beat tracker example below.
S = librosa.feature.melspectrogram(y, sr=sr, n_fft=2048, hop_length=64, n_mels=128)
print "S - ******************************"
print S

# Convert to log scale (dB). We'll use the peak power as reference.
log_S = librosa.logamplitude(S, ref_power=np.max)
print "log_S - ******************************"
print log_S

##############################################################################################################################
##############################################################################################################################
##############################################################################################################################

y_harmonic, y_percussive = librosa.effects.hpss(y)
print "y_harmonic - ******************************"
print y_harmonic

print "y_percussive - ******************************"
print y_percussive

# What do the spectrograms look like?
# Let's make and display a mel-scaled power (energy-squared) spectrogram
# We use a small hop length of 64 here so that the frames line up with the beat tracker example below.
S_harmonic = librosa.feature.melspectrogram(y_harmonic, sr=sr, n_fft=2048, hop_length=64, n_mels=128)
print "S_harmonic - ******************************"
print S_harmonic

S_percussive = librosa.feature.melspectrogram(y_percussive, sr=sr, n_fft=2048, hop_length=64, n_mels=128)
print "S_percussive - ******************************"
print S_percussive

# Convert to log scale (dB). We'll use the peak power as reference.
log_Sh = librosa.logamplitude(S_harmonic, ref_power=np.max)
print "log_Sh - ******************************"
print log_Sh

log_Sp = librosa.logamplitude(S_percussive, ref_power=np.max)
print "log_Sp - ******************************"
print log_Sp

##############################################################################################################################
##############################################################################################################################
##############################################################################################################################
# Next, we'll extract the top 20 Mel-frequency cepstral coefficients (MFCCs)
mfcc = librosa.feature.mfcc(S=log_S, n_mfcc=12)
print "mfcc - ******************************"
print mfcc

delta_mfcc = librosa.feature.delta(mfcc)
print "delta_mfcc - ******************************"
print delta_mfcc

delta2_mfcc = librosa.feature.delta(mfcc, order=2)
print "delta2_mfcc - ******************************"
print delta2_mfcc

# For future use, we'll stack these together into one matrix
M = np.vstack([mfcc, delta_mfcc, delta2_mfcc])

##############################################################################################################################
##############################################################################################################################
##############################################################################################################################

# We'll use a longer FFT window here to better resolve low frequencies
# We'll use the harmonic component to avoid pollution from transients
C = librosa.feature.chromagram(y=y_harmonic, sr=sr, n_fft=4096, hop_length=64)
print "C - ******************************"
print C
##############################################################################################################################
##############################################################################################################################
##############################################################################################################################

tempo, beats = librosa.beat.beat_track(y=y_percussive, sr=sr, hop_length=64)
print "tempo - ******************************"
print tempo

print "beats - ******************************"
print beats


##############################################################################################################################
##############################################################################################################################
##############################################################################################################################
"""
OUTPUT --

/usr/local/bin/python /Users/varadmeru/uci-related/uci-courses/cs274c-deeplearning/cs-274-project/transforming-audio.py
AUDIO FILE -  GetLucky.mp3

AUDIO FILE (y) -  [ -1.91535401e-05  -3.10689356e-05  -1.37271272e-05 ...,   0.00000000e+00
   0.00000000e+00   0.00000000e+00]
AUDIO FILE (sr) -  22050

S - ******************************
[[  1.69693560e-06   1.69970440e-06   1.70793262e-06 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]
 [  2.72061086e-10   2.77243939e-10   2.89850297e-10 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]
 [  8.78976594e-10   8.77333772e-10   8.71545627e-10 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]
 ...,
 [  4.76218205e-11   4.68784606e-11   4.47217584e-11 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]
 [  4.48812483e-11   4.40405885e-11   4.15982010e-11 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]
 [  4.06974412e-11   3.99196432e-11   3.76601876e-11 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]]

log_S - ******************************
[[-80. -80. -80. ..., -80. -80. -80.]
 [-80. -80. -80. ..., -80. -80. -80.]
 [-80. -80. -80. ..., -80. -80. -80.]
 ...,
 [-80. -80. -80. ..., -80. -80. -80.]
 [-80. -80. -80. ..., -80. -80. -80.]
 [-80. -80. -80. ..., -80. -80. -80.]]

y_harmonic - ******************************
[ -1.74648649e-05  -2.00382929e-05  -1.52587036e-05 ...,   0.00000000e+00
   0.00000000e+00   0.00000000e+00]

y_percussive - ******************************
[  1.50358085e-06  -5.88421017e-06   3.79144194e-06 ...,   0.00000000e+00
   0.00000000e+00   0.00000000e+00]

S_harmonic - ******************************
[[  1.49728947e-06   1.50527073e-06   1.52850034e-06 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]
 [  5.11590108e-09   5.01943334e-09   4.73576736e-09 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]
 [  1.26088608e-09   1.24156339e-09   1.18570774e-09 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]
 ...,
 [  2.35298982e-12   2.36126471e-12   2.38798312e-12 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]
 [  2.24938303e-13   2.23833686e-13   2.20732490e-13 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]
 [  7.60604434e-16   7.84670050e-16   8.59228816e-16 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]]

S_percussive - ******************************
[[  1.99962724e-11   2.07029461e-11   2.32734719e-11 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]
 [  7.42407282e-11   7.45773564e-11   7.57934493e-11 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]
 [  3.85824219e-10   3.82031194e-10   3.70473914e-10 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]
 ...,
 [  2.08357176e-11   2.04781098e-11   1.94383985e-11 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]
 [  2.79649693e-11   2.74374727e-11   2.59048662e-11 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]
 [  2.81705958e-11   2.76322790e-11   2.60684881e-11 ...,   0.00000000e+00
    0.00000000e+00   0.00000000e+00]]

log_Sh - ******************************
[[-80. -80. -80. ..., -80. -80. -80.]
 [-80. -80. -80. ..., -80. -80. -80.]
 [-80. -80. -80. ..., -80. -80. -80.]
 ...,
 [-80. -80. -80. ..., -80. -80. -80.]
 [-80. -80. -80. ..., -80. -80. -80.]
 [-80. -80. -80. ..., -80. -80. -80.]]

log_Sp - ******************************
[[-80. -80. -80. ..., -80. -80. -80.]
 [-80. -80. -80. ..., -80. -80. -80.]
 [-80. -80. -80. ..., -80. -80. -80.]
 ...,
 [-80. -80. -80. ..., -80. -80. -80.]
 [-80. -80. -80. ..., -80. -80. -80.]
 [-80. -80. -80. ..., -80. -80. -80.]]

mfcc - ******************************
[[ -9.05096680e+02  -9.05096680e+02  -9.05096680e+02 ...,  -9.05096680e+02  -9.05096680e+02  -9.05096680e+02]
 [  1.57651669e-14   1.57651669e-14   1.57651669e-14 ...,   1.57651669e-14  -3.55271368e-14  -3.55271368e-14]
 [  1.06359366e-13   1.06359366e-13   1.06359366e-13 ...,   1.06359366e-13   4.75175455e-14   4.75175455e-14]
 ...,
 [ -1.84297022e-14  -1.84297022e-14  -1.84297022e-14 ...,  -1.84297022e-14  -1.77635684e-14  -1.77635684e-14]
 [ -6.88338275e-15  -6.88338275e-15  -6.88338275e-15 ...,  -6.88338275e-15  1.88737914e-14   1.88737914e-14]
 [  1.15463195e-14   1.15463195e-14   1.15463195e-14 ...,   1.15463195e-14   8.88178420e-15   8.88178420e-15]]

delta_mfcc - ******************************
[[ -8.14587012e+03  -6.33567676e+03  -3.62038672e+03 ...,   1.36424205e-12  -1.09139364e-11  -2.00088834e-11]
 [  1.41886503e-13   1.10356169e-13   6.30606678e-14 ...,   0.00000000e+00  -2.05169215e-13  -3.59046126e-13]
 [  9.57234292e-13   7.44515560e-13   4.25437463e-13 ...,   0.00000000e+00  -2.35367281e-13  -4.11892742e-13]
 ...,
 [ -1.65867320e-13  -1.29007915e-13  -7.37188088e-14 ...,   0.00000000e+00  2.66453526e-15   4.66293670e-15]
 [ -6.19504448e-14  -4.81836793e-14  -2.75335310e-14 ...,   0.00000000e+00  1.03028697e-13   1.80300219e-13]
 [  1.03916875e-13   8.08242362e-14   4.61852778e-14 ...,   0.00000000e+00  -1.06581410e-14  -1.86517468e-14]]
delta2_mfcc - ******************************

[[ -8.23637979e+04  -6.33567676e+04  -2.71529004e+04 ...,   0.00000000e+00
   -4.91127139e-11  -1.22327037e-10]
 [  1.43463019e-12   1.10356169e-12   4.72955008e-13 ...,   0.00000000e+00
   -8.20676860e-13  -2.05169215e-12]
 [  9.67870228e-12   7.44515560e-12   3.19078097e-12 ...,   0.00000000e+00
   -9.41469125e-13  -2.35367281e-12]
 ...,
 [ -1.67710290e-12  -1.29007915e-12  -5.52891066e-13 ...,   0.00000000e+00
    1.06581410e-14   2.66453526e-14]
 [ -6.26387830e-13  -4.81836793e-13  -2.06501483e-13 ...,   0.00000000e+00
    4.12114787e-13   1.03028697e-12]
 [  1.05071507e-12   8.08242362e-13   3.46389584e-13 ...,   0.00000000e+00
   -4.26325641e-14  -1.06581410e-13]]

C - ******************************
[[ 0.77211914  0.77253714  0.77406473 ...,  0.          0.          0.        ]
 [ 0.65805804  0.65855177  0.66033902 ...,  0.          0.          0.        ]
 [ 0.58632775  0.58736224  0.59133261 ...,  0.          0.          0.        ]
 ...,
 [ 0.6384172   0.6397822   0.64419643 ...,  0.          0.          0.        ]
 [ 0.85962206  0.85986029  0.86127926 ...,  0.          0.          0.        ]
 [ 1.          1.          1.         ...,  0.          0.          0.        ]]

tempo - ******************************
116.134129213

beats - ******************************
[   62   239   422   596   778   952  1133  1307  1488  1664  1844  2021
  2201  2376  2557  2733  2913  3089  3269  3445  3626  3802  3982  4157
  4337  4511  4695  4871  5051  5228  5409  5586  5763  5942  6121  6296
  6478  6653  6835  7011  7188  7367  7545  7721  7901  8078  8249  8434
  8614  8791  8970  9145  9326  9503  9683  9859 10038 10215 10395 10571
 10752 10931 11108 11284 11463 11643 11822 11997 12177 12354 12536 12709
 12889 13066 13246 13422 13603 13778 13960 14137 14315 14491 14670 14845
 15027 15204 15383 15559 15739 15914 16096 16272 16453 16629 16809 16985
 17165 17344 17524 17698 17880 18055 18236 18409 18590 18767 18945 19122
 19303 19479 19659 19836 20015 20192 20371 20546 20727 20905 21083 21258
 21438 21615 21796 21973 22152 22330 22510 22686 22865 23043 23224 23398
 23580 23755 23936 24110 24289 24468 24647 24823 25003 25179 25360 25535
 25715 25890 26071 26246 26427 26603 26784 26958 27139 27315 27497 27673
 27853 28031 28210 28388 28565 28743 28922 29098 29280 29455 29629 29812
 29991 30168 30346 30523 30703 30881 31060 31235 31416 31591 31773 31947
 32127 32304 32484 32660 32841 33020 33197 33373 33555 33734 33910 34086
 34265 34445 34624 34800 34980 35157 35338 35512 35692 35869 36048 36224
 36405 36580 36762 36939 37117 37293 37473 37647 37829 38007 38186 38362
 38541 38716 38898 39074 39255 39431 39611 39788 39968 40147 40326 40501
 40682 40858 41039 41212 41392 41569 41749 41925 42106 42282 42463 42639
 42819 42997 43176 43351 43534 43708 43888 44063 44246 44419 44601 44776
 44958 45133 45313 45488 45667 45845 46027 46201 46384 46555 46738 46914
 47095 47271 47452 47626 47808 47983 48163 48339 48518 48696 48874 49050
 49230 49408 49586 49762 49941 50120 50298 50475 50654 50833 51010 51187
 51368 51546 51725 51902 52081 52258 52438 52612 52790 52971 53149 53324
 53504 53683 53861 54038 54219 54396 54575 54751 54931 55108 55288 55463
 55642 55820 55999 56176 56355 56533 56711 56888 57069 57246 57425 57601
 57782 57958 58138 58313 58493 58670 58849 59026 59205 59383 59562 59739
 59919 60097 60275 60452 60633 60810 60989 61164 61345 61522 61700 61878
 62057 62234 62413 62590 62770 62948 63126 63302 63483 63659 63838 64015
 64195 64372 64551 64728 64907 65084 65263 65441 65620 65799 65977 66151
 66333 66510 66690 66865 67043 67219 67401 67577 67757 67934 68113 68292
 68470 68647 68825 69002 69182 69360 69539 69713 69894 70072 70251 70428
 70607 70783 70964 71141 71320 71498 71676 71852 72032 72211 72390 72565
 72744 72922 73101 73278 73458 73634 73814 73991 74170 74347 74526 74703
 74883 75061 75240 75414 75595 75773 75951 76129 76308 76483 76664 76840
 77019 77197 77379 77552 77735 77909 78090 78264 78444 78621 78801 78979
 79158 79333 79513 79690 79869 80045 80226 80401 80583 80759 80939 81113
 81294 81471 81652 81829 82008 82186 82365 82542 82720 82898 83079 83254
 83435 83611 83791 83966 84146]

Process finished with exit code 0
"""